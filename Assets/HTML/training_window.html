<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Training</title>
        <link rel="stylesheet", href="../CSS/training.css">
    </head>
    <body>
        <div id="main_container">
            <h1 id="dataBox"></h1>
            <h1 id="infoBox"></h1>
        </div>
        <script>
            const execFile = require('child_process').execFile;
            const manage = require("../../Tools").manage;

            const dataBox = document.getElementById("dataBox");
            const infoBox = document.getElementById("infoBox");

            const args = {
                "subcommand":"train",
                "dataset":".\\Testing_Assets\\dataset",
                "style_image":".\\Testing_Assets\\style_image.jpg",
                "save_model_dir":require('path').join(require('os').homedir(), 'Desktop') + "\\Models",
                "name":"Test_Model",
                "cuda":1
            }

            const train_process = execFile("Assets\\Executables\\neural_style\\neural_style.exe", [JSON.stringify(args)]);
            console.log(train_process);

            train_process.stdout.on('data', (data) => {
                try {
                    manage(JSON.parse(data.toString()), dataBox);
                    if (train_process.stdin.writable) {
                        train_process.stdin.write("ready\n");
                    } else {
                        console.error("stdin is not writable");
                    }
                } catch (e) {
                    console.error(e + " with: " + data.toString());
                }
            });

            train_process.stderr.on('data', (data) => {
                console.error(data.toString());
            });

            train_process.on('exit', (code) => {
                console.log("neural style exited with code: " + code.toString());
                if (code == 1) {
                    infoBox.innerHTML = "Fatal Error";
                } else {
                    infoBox.innerHTML = "Done!";
                }
            });
        </script>
    </body>
</html>